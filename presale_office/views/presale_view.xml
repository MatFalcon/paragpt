<?xml version='1.0' encoding='utf-8'?>
<odoo>
    <data>
        <record id="presale_order_tree_view" model="ir.ui.view">
            <field name="name">presale.order.tree.view</field>
            <field name="model">presale.order</field>
            <field name="arch" type="xml">
                <tree string="Presale Quotes" create="false">
                    <field name="name" decoration-bf="1" decoration-it="1"/>
                    <field name="partner_id"/>
                    <field name="date"/>
                    <field name="income_date"/>
                    <field name="commercials_ids"/> <!-- widget="many2many_tags"-->
                    <field name="designers_ids"/>
                </tree>
            </field>
        </record>
        <!--                PESTAÃ‘A INICIAL                  -->
        <record id="presale_order_form_view" model="ir.ui.view">
            <field name="name">presale.order.form.view</field>
            <field name="model">presale.order</field>
            <field name="arch" type="xml">
                <form string="Presale Order">
                    <header>
                        <button name="assign_internal_approval" type="object" string="Aprobar"
                                invisible="state not in ['Borrador']"
                                icon="fa-check"/>
                        <button name="assign_draft" type="object" string="Go Back to Draft"
                                invisible="state in ['Borrador']"
                                icon="fa-pencil-square-o"/>
                        <field name="state" widget="statusbar" options="{'clickable': False}"/>
                        <field name="previous_state" widget="statusbar" invisible="1"/>
                    </header>

                    <header>
                        <button name="generate_sale_order" string="GENERATE SALE ORDER" type="object"
                                class="btn btn-success" icon="fa-usd" groups="presale_singel.group_presale_manager"
                                invisible="state in ['Borrador', 'Aprobacion Interna']"/>
                    </header>

                    <sheet>
                        <widget name="web_ribbon" title="Borrador" bg_color="bg-warning" invisible="state in ['Aprobado']"/>
                        <widget name="web_ribbon" title="Aprobado" bg_color="bg-success" invisible="state in ['Borrador']"/>
                        <div class="oe_title">
                            <h2>
                                <field name="name"/>
                            </h2>
                        </div>
                        <group>
                            <group string="Sale Info">
                                <field name="team_id" required="0"/>
                                <field name="partner_id" required="0"/>
                                <field name="commercials_ids" widget="many2many_tags"
                                       options="{'color_field': 'color'}"/>
                            </group>
                            <group string="Rates">
                                <field name="company_currency" widget="boolean_toggle"/>
                                <field name="aplicar_descuento" widget="boolean_toggle"/>
                                <field name="valor_descuento" invisible="not aplicar_descuento"/>
                                <field name="rate_date"/>
                                <field name="currency_id"/>
                                <field name="rate"/>
                                <field name="pricelist_id"/>
                                <button name="aplicar_descuento_preventa" type="object" string="Aplicar descuento" class="btn btn-warning"/>

                            </group>
                        </group>
                        <group>
                            <group string="Budget Creation">
                                <field name="create_or_update" widget="boolean_toggle"/>
                                <field name="sales_order_id"/>
                            </group>

                            <group string="Opportunity">
                                <field name="lead_id"/>
                            </group>
                        </group>
                        <group>
                            <group string="Totales">
                                <field name="total_con_descuento" readonly="1"/>
                                <field name="total_sin_descuento" readonly="1"/>
                                <field name="margen_promedio" readonly="1"/>
                                <button name="calc_totales" type="object" string="Recalcular" class="btn btn-warning"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Product Items">
                                <field name="item_presale_ids">
                                    <tree>
                                        <field name="product_id"/>
                                        <field name="imprevisto"/>
                                        <field name="total_con_descuento"/>
                                        <field name="total_sin_descuento"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="activity_ids" widget="mail_activity"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <!--Crear Detalle-->
        <record id="presale_order_item_form_view_detail" model="ir.ui.view">
            <field name="name">presale.order.item.form.viewdetail</field>
            <field name="model">presale.order.item.detail</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Presale Order Item">
                    <group string="Producto">
                        <group>
                            <field name="product_id"  options="{'no_create': True}" />
                            <field name="uom_id" required="0"/>
                        </group>
                        <group>
                            <field name="qty"/>
                            <field name="standard_price" string="Unit Cost Unit"/>
                        </group>
                    </group>
                    <group>
                        <group>
                            <field name="supplier_id" required="0"/>
                            <field name="account_analytic_id" widget="many2many_tags" required="0"/>
                        </group>
                        <group>
                            <field name="total_cost"/>
                        </group>
                    </group>

                </form>
            </field>
        </record>

        <record id="presale_order_heading" model="ir.ui.view">
            <field name="name">presale.order.heading.form.view</field>
            <field name="model">presale.order.heading</field>
            <field name="arch" type="xml">
                <form string="Presale Heading">
                    <sheet>
                        <group>
                            <group string="Heading">
                                <field name="name"/>
                            </group>
                        </group>

                        <group>

                            <group string="Template Generation"
                                   invisible="context.get('default_create_item_template', False) == 1">
                                <field name="create_item_template" widget="boolean_toggle"/>
                                <field name="presale_item_template" widget="boolean_toggle"
                                       invisible="not create_item_template"/>  <!-- attrs="{'invisible': [('create_item_template', '=', False)]}" invisible="context.get('default_create_item_template', False) == 1"-->
                                <field name="item_template_ids" domain="[('presale_item_template','=',True)]"/>
                                <button name="select_item_template" string="Asignar Plantilla" type="object"
                                        class="btn btn-success" icon="fa-plus"/>
                            </group>
                        </group>

                        <notebook>
                            <!--  Detalles Aqui-->
                            <page string="Items">
                                <field name="order_detail_id">
                                    <tree>
                                        <field name="code" decoration-bf="1"/>
                                        <field name="product_id"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>


        <record id="presale_order_item_form_view" model="ir.ui.view">
            <field name="name">presale.order.item.form.view</field>
            <field name="model">presale.order.item</field>
            <field name="arch" type="xml">
                <form string="Presale Order Item">
                    <group>
                        <group>
                            <field name="name"/>
                            <field name="es_producto_temporal" invisible="1"/>
                            <field name="product_id" invisible="not imprevisto in ('importados', 'tercerizados')"/>
                            <field name="uom_id"/>
                        </group>
                        <group>
                            <field name="qty"/>
                            <field name="standard_price"/>
                            <field name="detailed_type"/>
                            <field name="categ_id"/>
                            <field name="image_128" widget="image" class="oe_avatar"/>

                        </group>
                    </group>
                    <group>
                        <group string="Calc. de redondeo">
                            <field name="rounding_factor"/>
                        </group>
                        <group string="Descuento">
                            <field name="porcentaje_descuento"/>
                        </group>    
                        <group string="Imprevistos">
                            <field name="imprevisto"/>
                            <field name="imprevisto_valor"/>
                            <field name="imprevisto_calculo"/>
                        </group>
                        <group string="Costos Unitarios">
                            <field name="total_cost_item"/>
                            <field name="precio_venta_margen_unit"/>
                            <field name="precio_unit_dcto"/>
                        </group>
                    </group>
                    <group>
                        <group string="Sin Descuento">
                            <field name="total_sin_descuento"/>
                            <field name="margen_sin_descuento"/>
                            <field name="margen_porcentaje_sin_descuento" widget="percentage"/>
                        </group>
                        <group string="Con Descuento">
                            <field name="total_con_descuento"/>
                            <field name="margen_con_descuento"/>
                            <field name="margen_porcentaje_con_descuento" widget="percentage"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Detail">

                            <tree>
                                <field name="detail_ids"><!-- presale.order.item.detail-->
                                    <tree>
                                        <field name="product_id"/>
                                        <field name="standard_price" string="Precio de Costo" sum="Precio de Costo"/>
                                        <field name="qty" string="Cantidad"/>
                                        <field name="total_cost" string="Total Costo" sum="Total Costo"/>
                                    </tree>
                                </field>
                            </tree>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_open_presaleorder">
            <field name="name">Presale Quotes</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">presale.order</field>
            <field name="view_mode">tree,form,pivot</field>
        </record>

        <record model="ir.actions.act_window" id="action_open_presaleorder_headings">
            <field name="name">Presale Headings</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">presale.order.heading</field>
            <field name="domain">[('presale_item_template','=',True)]</field>
            <field name="view_mode">tree,form,pivot</field>
            <field name="context">{'default_create_item_template':1,'default_presale_item_template': True}</field>
        </record>

        <record model="ir.actions.act_window" id="action_open_presaleorder_items">
            <field name="name">Presale Items</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">presale.order.item</field>
            <field name="view_mode">tree,form</field>
        </record>

        <record model="ir.actions.act_window" id="action_open_presaleorder_items_details">
            <field name="name">Presale Items Details</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">presale.order.item.detail</field>
            <field name="view_mode">pivot,graph</field>
        </record>
    </data>
</odoo>
