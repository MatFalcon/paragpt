<odoo>
	<data>
		<!-- sobreescribimos los datos del formulario -->
		<record model="ir.ui.view" id="account_payment_form_inherit_apicontinental">
			<field name="name">account_payment_form_inherit_apicontinental</field>
			<field name="model">account.payment</field>
			<field name="inherit_id" ref="account.view_account_payment_form" />
			<field name="arch" type="xml">

				<!-- En la cabecera agregamos el boton para autorizar la transferencia -->
				<xpath expr="//header/button[@name='action_cancel']" position="before">
					<button
						name="autorizar_transferencia"
						type="object"
						string="Autorizar Transferencia"
						attrs="{'invisible': ['|', ('is_continental', '=' , False), ('apicontinental_state', '!=', 'pending')]}"
						class="oe_highlight"
					/>
					<button
						name="anular_transferencia"
						type="object"
						string="Anular Transferencia"
						attrs="{'invisible': ['|', ('is_continental', '=' , False), ('apicontinental_state', '!=', 'pending')]}"
						class="btn btn-secondary"
					/>
				</xpath>

				<!-- Si es de continental no se puede volver a borrador -->
				<xpath expr="//button[@name='action_draft']" position="attributes">
					<attribute name="attrs">{'invisible': ['|', ('state', 'not in', ('posted', 'cancel')), ('is_continental', '=' , True)]}</attribute>
				</xpath>

				<!-- Campos relacionados a las transferencias a continental -->
				<xpath expr="//field[@name='partner_bank_id']" position="after">
					<!-- interbancaria -->
					<field name="apicontinental_listado_procedencia" attrs="{'invisible': [('tipo_pago', '!=', 'interbancaria')]}" />
					<field name="apicontinental_motivo_transaccion" attrs="{'invisible': [('tipo_pago', '!=', 'interbancaria')]}" />

					<!-- interna y cheque gerencia  -->
					<field name="apicontinental_numero_pago" attrs="{'invisible': [('tipo_pago', 'not in', ['interna', 'cheque_gerencia'])]}" />
					<field name="apicontinental_concepto" attrs="{'invisible': [('tipo_pago', 'not in', ['interna', 'cheque_gerencia'])]}" />

					<!-- cheque gerencia -->
					<field name="apicontinental_sucursal" attrs="{'invisible': [('tipo_pago', '!=', 'cheque_gerencia')]}" />
					<field name="apicontinental_direccion_beneficiario" attrs="{'invisible': [('tipo_pago', '!=', 'cheque_gerencia')]}" />
					<field name="apicontinental_autorizado_nombre" attrs="{'invisible': [('tipo_pago', '!=', 'cheque_gerencia')]}" />
					<field name="apicontinental_autorizado_documento" attrs="{'invisible': [('tipo_pago', '!=', 'cheque_gerencia')]}" />
				</xpath>

				<!-- Agregamos un tab para mostrar los datos de la transferencia -->
				<xpath expr="//sheet" position="inside">
					<notebook groups="integracion_api_continental.logs_api" attrs="{'invisible': [('is_continental', '!=' , True)]}">

						<!-- mostramos los datos relacionados a la consulta del API -->
						<page string="Continental">
							<group string="Datos de la última petición realizada">
								<field name="is_continental" invisible="1" />
								<field name="apicontinental_numero_ticket" readonly="1" />
								<field name="apicontinental_comprobante" readonly="1" />
								<!-- <field name="apicontinental_request" readonly="1" /> -->
								<field name="apicontinental_response" readonly="1" />
								<field name="apicontinental_error" readonly="1" />
								<field name="apicontinental_autorizacion_response" readonly="1" />
								<field name="apicontinental_anulacion_response" readonly="1" />
								<field name="apicontinental_state" readonly="1" />

								<button
									name="crear_solicitud"
									type="object"
									string="reintentar crear solicitud"
									class="oe_highlight"
									attrs="{'invisible': [('apicontinental_state', '!=', 'error')]}"
								/>
							</group>
							<group>
								<field name="apicontinental_transferencia_id" string="Estado de la transferencia API Continental" readonly="1" />
								<button
									name="consultar_comprobante"
									type="object"
									string="actualizar comprobante"
									class="oe_highlight"
								/>
							</group>
						</page>

						<!-- Mostramos el historico de consultas -->
						<page string="Consultas al API" groups="integracion_api_continental.logs_requests_api">
							<field name="apicontinental_requests" widget="one2many_list" readonly="1">
								<tree>
									<field name="name" />
									<field name="user" />
									<field name="fecha" />
									<field name="status" />
									<field name="error" />
								</tree>
							</field>
						</page>
					</notebook>
				</xpath>

			</field>
		</record>

		<!-- sobreescribimos el wizard de registrar pagos -->
		<record model="ir.ui.view" id="view_account_payment_register_form_inherit_apicontinental">
			<field name="name">view.account.payment.register.form.inherit_apicontinental</field>
			<field name="model">account.payment.register</field>
			<field name="inherit_id" ref="account.view_account_payment_register_form" />
			<field name="arch" type="xml">

				<!-- Campos relacionados a las transferencias a continental -->
				<!-- <xpath expr="//field[@name='partner_bank_id']" position="after"> -->
				<xpath expr="//field[@name='observaciones']" position="after">
					<!-- interbancaria -->
					<field name="apicontinental_listado_procedencia" attrs="{'invisible': [('tipo_pago', '!=', 'interbancaria')]}" />
					<field name="apicontinental_motivo_transaccion" attrs="{'invisible': [('tipo_pago', '!=', 'interbancaria')]}" />

					<!-- interna y cheque gerencia  -->
					<field name="apicontinental_numero_pago" attrs="{'invisible': [('tipo_pago', 'not in', ['interna', 'cheque_gerencia'])]}" />
					<field name="apicontinental_concepto" attrs="{'invisible': [('tipo_pago', 'not in', ['interna', 'cheque_gerencia'])]}" />

					<!-- cheque gerencia -->
					<field name="apicontinental_sucursal" attrs="{'invisible': [('tipo_pago', '!=', 'cheque_gerencia')]}" />
					<field name="apicontinental_direccion_beneficiario" attrs="{'invisible': [('tipo_pago', '!=', 'cheque_gerencia')]}" />
					<field name="apicontinental_autorizado_nombre" attrs="{'invisible': [('tipo_pago', '!=', 'cheque_gerencia')]}" />
					<field name="apicontinental_autorizado_documento" attrs="{'invisible': [('tipo_pago', '!=', 'cheque_gerencia')]}" />
				</xpath>

			</field>
		</record>

		<!-- Sobreescribmimos la vista account.view_account_supplier_payment_tree y agregamos una columna mas -->
		<record model="ir.ui.view" id="account_supplier_payment_tree_inherit_apicontinental">
			<field name="name">account_supplier_payment_tree_inherit_apicontinental</field>
			<field name="model">account.payment</field>
			<field name="inherit_id" ref="account.view_account_supplier_payment_tree" />
			<field name="arch" type="xml">
				<xpath expr="//tree" position="inside">
					<field name="apicontinental_numero_ticket" />
				</xpath>
			</field>
		</record>
	</data>
</odoo>